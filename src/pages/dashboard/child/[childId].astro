---
import DashboardLayout from '../../../layouts/DashboardLayout.astro';
import ChildDetailPage from '../../../components/dashboard/ChildDetailPage';
import { mockChildren, mockSessions } from '../../../data/mockDashboardData';

// Generate a page for each child at build time
export function getStaticPaths() {
  return mockChildren.map(child => ({
    params: { childId: child.id },
  }));
}

// Get the childId from the URL
const { childId } = Astro.params;

// Find the child
const child = mockChildren.find(c => c.id === childId);

// If child not found, redirect to dashboard
if (!child) {
  return Astro.redirect('/dashboard');
}

// Flatten sessions from Record<string, Session[]> to Session[]
const allSessions = Object.values(mockSessions).flat();
---

<DashboardLayout title={`${child.firstName}'s Profile - Mind Foundry`}>
  <ChildDetailPage 
    client:load 
    child={child} 
    allSessions={allSessions}
  />
</DashboardLayout>